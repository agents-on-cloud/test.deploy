pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                echo("I am in build")
                sshPublisher(
                    continueOnError: false, failOnError: true,
                    publishers: [
                    sshPublisherDesc(
                        configName: "saleh-test",
                        verbose: true,
                        transfers: [
                        sshTransfer(
                            execCommand: " rm -rf /var/www/test-front"
                        ),
                        sshTransfer(
                            sourceFiles: "**/*",
                            remoteDirectory: "test-front",
                            execCommand:"cd /var/www/test-front && sudo npm i && sudo npm run build && pm2 start"
                           
                        ),
                    ])
                ])
            }
        }
        stage('Test') {
            steps {
                echo("I am in Test")
            }
        }
        stage('Deploy') {
            steps {
                echo("I am in Deploy")
                sshPublisher(
                    continueOnError: false, failOnError: true,
                    publishers: [
                    sshPublisherDesc(
                        configName: "saleh-test",
                        verbose: true,
                        transfers: [
                         sshTransfer(
                                 execCommand: "cd /var/www/test-front && pm2 start"
                         )
                     
                    ])
                ])
            }
        }
    }
}
